[supervisord]
nodaemon=true
logfile=/dev/null
pidfile=/tmp/supervisord.pid

[program:socket-hub]
command=/bin/sh -c "rm -f /tmp/prometheus/socket-hub/* && exec uvicorn app.main:asgi_app --app-dir /app/socket-hub --host 127.0.0.1 --port 8000 --workers 1"
autostart=true
autorestart=true
priority=10
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0
environment=PYTHONPATH="/app:/app/socket-hub:/app/dispatcher:/app/worker:/app/shared",PROMETHEUS_MULTIPROC_DIR="/tmp/prometheus/socket-hub",APP_ENV="%(ENV_APP_ENV)s",SERVICE_VERSION="%(ENV_SERVICE_VERSION)s"

[program:dispatcher]
command=/bin/sh -c "rm -f /tmp/prometheus/dispatcher/* && exec uvicorn app.main:app --app-dir /app/dispatcher --host 127.0.0.1 --port 8001 --workers 1"
autostart=true
autorestart=true
priority=10
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0
environment=PYTHONPATH="/app:/app/socket-hub:/app/dispatcher:/app/worker:/app/shared",PROMETHEUS_MULTIPROC_DIR="/tmp/prometheus/dispatcher",APP_ENV="%(ENV_APP_ENV)s",SERVICE_VERSION="%(ENV_SERVICE_VERSION)s"

[program:worker]
command=/bin/sh -c "rm -f /tmp/prometheus/worker/* && exec uvicorn app.main:app --app-dir /app/worker --host 127.0.0.1 --port 8002 --workers 1"
autostart=true
autorestart=true
priority=10
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0
environment=PYTHONPATH="/app:/app/socket-hub:/app/dispatcher:/app/worker:/app/shared",PROMETHEUS_MULTIPROC_DIR="/tmp/prometheus/worker",APP_ENV="%(ENV_APP_ENV)s",SERVICE_VERSION="%(ENV_SERVICE_VERSION)s"

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
priority=20
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0
